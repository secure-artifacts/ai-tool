# ğŸ“Š è¡¨æ ¼åŒæ­¥åŠŸèƒ½ä½¿ç”¨è¯´æ˜

æœ¬åŠŸèƒ½å¯ä»¥å°† AI å·¥å…·çš„å¤„ç†ç»“æœè‡ªåŠ¨ä¿å­˜åˆ° Google Sheetsï¼Œæ”¯æŒä»¥ä¸‹å·¥å…·ï¼š
- AI å›¾ç‰‡è¯†åˆ«
- æç¤ºè¯å·¥å…·
- æ‰¹é‡ç¿»è¯‘
- ä¸“ä¸šæŸ¥é‡

---

## âš ï¸ å…³äºè®¾ç½®ä¿å­˜

**è®¾ç½®ä¿å­˜ä½ç½®ï¼šæµè§ˆå™¨æœ¬åœ°å­˜å‚¨ (localStorage)**

- âœ… åŒä¸€æµè§ˆå™¨ã€åŒä¸€è®¾å¤‡ï¼šè®¾ç½®ä¼šä¿ç•™
- âŒ ä¸åŒæµè§ˆå™¨/ä¸åŒè®¾å¤‡ï¼šè®¾ç½®ä¸ä¼šåŒæ­¥
- âŒ æ¸…é™¤æµè§ˆå™¨æ•°æ®ï¼šè®¾ç½®ä¼šä¸¢å¤±

**å¦‚éœ€è·¨è®¾å¤‡ä½¿ç”¨ï¼š**
æ¯å°è®¾å¤‡/æµè§ˆå™¨éœ€è¦å•ç‹¬é…ç½®ä¸€æ¬¡ã€‚

---

## ä¸€ã€é…ç½® Google Apps Script

### 1. åˆ›å»º Google è¡¨æ ¼
1. æ‰“å¼€ [Google Sheets](https://sheets.google.com)
2. åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºç™½è¡¨æ ¼
3. è®°ä½æ­¤è¡¨æ ¼ï¼Œæ•°æ®å°†è‡ªåŠ¨ä¿å­˜åˆ°è¿™é‡Œ

### 2. åˆ›å»º Apps Script
1. åœ¨è¡¨æ ¼ä¸­ç‚¹å‡»èœå•ï¼š**æ‰©å±•ç¨‹åº â†’ Apps Script**
2. åˆ é™¤é»˜è®¤ä»£ç ï¼Œç²˜è´´ä»¥ä¸‹**å®Œæ•´ä»£ç **ï¼š

```javascript
/**
 * Web2Sheet GAS Backend v3.1
 * å®Œæ•´ç‰ˆ - ä¿ç•™æ‰€æœ‰åŸæœ‰åŠŸèƒ½ + æ”¯æŒè‡ªåŠ¨åˆ›å»ºåˆ†é¡µå’Œè¡¨å¤´
 * 
 * åŠŸèƒ½åˆ—è¡¨ï¼š
 * - getSoftwares: è·å–è½¯ä»¶åˆ—è¡¨
 * - getCategories: è·å–åˆ†ç±»åˆ—è¡¨ï¼ˆçˆ¶åˆ†ç±» + å­åˆ†ç±»æ˜ å°„ï¼‰
 * - getConfig: å…¼å®¹æ—§ç‰ˆè·å–é…ç½®
 * - test: æµ‹è¯•è¿æ¥
 * - submit: æäº¤å•è¡Œæ•°æ®
 * - appendRows: æ‰¹é‡æ·»åŠ æ•°æ®è¡Œï¼ˆæ”¯æŒè‡ªåŠ¨åˆ›å»ºåˆ†é¡µå’Œè¡¨å¤´ï¼‰
 * 
 * Deployment: Execute as Me; Access: Anyone with the link
 */

function _json(obj){ 
  const o = ContentService.createTextOutput(JSON.stringify(obj)); 
  o.setMimeType(ContentService.MimeType.JSON); 
  return o; 
}

function doGet(e){
  try{
    const ss = SpreadsheetApp.getActive();
    const action = (e.parameter.action || "").trim();
    
    // è·å–è½¯ä»¶åˆ—è¡¨
    if(action === "getSoftwares"){
      const sheet = e.parameter.sheet || "Config_Softwares";
      return _json({ ok: true, list: _readCol(ss, sheet) });
    }
    
    // è·å–åˆ†ç±»åˆ—è¡¨
    if(action === "getCategories"){
      const sheet = e.parameter.sheet || "Config_Categories";
      const categories = _readCategories(ss, sheet);
      return _json(categories);
    }
    
    // å…¼å®¹æ—§ç‰ˆ getConfig
    if(action === "getConfig"){
      const cat = e.parameter.cat || "Config_Categories";
      return _json({ ok: true, categories: _readCol(ss, cat) });
    }
    
    // æµ‹è¯•è¿æ¥
    if(action === "test"){
      return _json({ ok: true, message: "è¿æ¥æˆåŠŸ" });
    }
    
    return _json({ ok: false, error: "Unknown action" });
  } catch(err) { 
    return _json({ ok: false, error: String(err) }); 
  }
}

function doPost(e){
  try{
    const ss = SpreadsheetApp.getActive();
    let payload = null;
    
    if (e.postData && e.postData.type === "application/x-www-form-urlencoded"){
      const dataStr = e.parameter.data;
      if(!dataStr) return _json({ok: false, error: "Missing data"});
      payload = JSON.parse(dataStr);
    } else if (e.postData && e.postData.contents){
      payload = JSON.parse(e.postData.contents);
    } else {
      return _json({ok: false, error: "No postData"});
    }

    const action = payload.action || "";
    
    // æäº¤å•è¡Œæ•°æ®
    if(action === "submit"){
      const sheetName = payload.sheet || payload.sheetData || "Data";
      const row = payload.row || [];
      if(!row.length) return _json({ok: false, error: "No row data"});
      
      const sh = ss.getSheetByName(sheetName); 
      if(!sh) throw new Error("Sheet not found: " + sheetName);
      
      sh.appendRow(row);
      return _json({ok: true, message: "æäº¤æˆåŠŸ"});
    }
    
    // æ‰¹é‡æ·»åŠ æ•°æ®è¡Œï¼ˆv3.1 æ–°å¢ï¼šæ”¯æŒè‡ªåŠ¨åˆ›å»ºåˆ†é¡µå’Œè¡¨å¤´ï¼‰
    if(action === "appendRows"){
      const sheetName = payload.sheetData || payload.sheet || "Data";
      const rows = payload.rows || [];
      const headers = payload.headers || null; // æ–°å¢ï¼šè¡¨å¤´å‚æ•°
      
      if(!rows.length) return _json({ok: false, error: "No rows"});
      
      let sh = ss.getSheetByName(sheetName);
      let sheetCreated = false;
      
      // å¦‚æœåˆ†é¡µä¸å­˜åœ¨ï¼Œè‡ªåŠ¨åˆ›å»º
      if(!sh){
        sh = ss.insertSheet(sheetName);
        sheetCreated = true;
        
        // å¦‚æœæä¾›äº†è¡¨å¤´ï¼Œæ·»åŠ è¡¨å¤´è¡Œ
        if(headers && headers.length){
          sh.appendRow(headers);
          // è®¾ç½®è¡¨å¤´æ ·å¼
          sh.getRange(1, 1, 1, headers.length)
            .setFontWeight("bold")
            .setBackground("#4285f4")
            .setFontColor("#ffffff");
          // å†»ç»“è¡¨å¤´è¡Œ
          sh.setFrozenRows(1);
          // è‡ªåŠ¨è°ƒæ•´åˆ—å®½
          for(var i = 1; i <= headers.length; i++){
            sh.autoResizeColumn(i);
          }
        }
      }
      
      const r = sh.getLastRow() + 1, c = 1;
      sh.getRange(r, c, rows.length, rows[0].length).setValues(rows);
      return _json({ok: true, inserted: rows.length, sheetCreated: sheetCreated});
    }

    return _json({ok: false, error: "Unknown action"});
  } catch(err) { 
    return _json({ok: false, error: String(err)}); 
  }
}

// è¯»å–å•åˆ—æ•°æ®
function _readCol(ss, sheetName){
  const sh = ss.getSheetByName(sheetName); 
  if(!sh) return [];
  const lastRow = sh.getLastRow();
  if(lastRow < 2) return [];
  const rng = sh.getRange(2, 1, lastRow - 1, 1).getValues();
  const out = [];
  for (let i = 0; i < rng.length; i++){ 
    const v = (rng[i][0] || "").toString().trim(); 
    if(v && out.indexOf(v) === -1) out.push(v); 
  }
  return out;
}

// è¯»å–åˆ†ç±»æ•°æ®ï¼ˆçˆ¶åˆ†ç±» + å­åˆ†ç±»ï¼‰
function _readCategories(ss, sheetName){
  const sh = ss.getSheetByName(sheetName); 
  if(!sh) return { parents: [], childrenMap: {} };
  
  const lastRow = sh.getLastRow();
  if(lastRow < 2) return { parents: [], childrenMap: {} };
  
  // å‡è®¾ Aåˆ—æ˜¯çˆ¶åˆ†ç±»ï¼ŒBåˆ—æ˜¯å­åˆ†ç±»
  const data = sh.getRange(2, 1, lastRow - 1, 2).getValues();
  
  const parents = [];
  const childrenMap = {};
  
  for (let i = 0; i < data.length; i++){
    const parent = (data[i][0] || "").toString().trim();
    const child = (data[i][1] || "").toString().trim();
    
    if(parent){
      if(parents.indexOf(parent) === -1){
        parents.push(parent);
        childrenMap[parent] = [];
      }
      if(child && childrenMap[parent].indexOf(child) === -1){
        childrenMap[parent].push(child);
      }
    }
  }
  
  return { parents: parents, childrenMap: childrenMap };
}
```

### 3. éƒ¨ç½² Web App
1. ç‚¹å‡» **éƒ¨ç½² â†’ æ–°å»ºéƒ¨ç½²**
2. é€‰æ‹©ç±»å‹ï¼š**ç½‘é¡µåº”ç”¨**
3. é…ç½®ï¼š
   - **æ‰§è¡Œèº«ä»½**ï¼šæˆ‘è‡ªå·±
   - **è°å¯ä»¥è®¿é—®**ï¼šä»»ä½•äºº
4. ç‚¹å‡» **éƒ¨ç½²**
5. **å¤åˆ¶ Web App URL**ï¼ˆå½¢å¦‚ `https://script.google.com/macros/s/xxx/exec`ï¼‰

---

## äºŒã€åœ¨è½¯ä»¶ä¸­é…ç½®

1. æ‰“å¼€ **AI åˆ›ä½œå·¥å…·åŒ…**
2. ç‚¹å‡»é¡¶éƒ¨å·¥å…·æ çš„ **âš™ï¸ è®¾ç½®** å›¾æ ‡
3. æ‰¾åˆ° **ğŸ“Š è¡¨æ ¼åŒæ­¥** åŒºåŸŸ
4. å¡«å†™é…ç½®ï¼š
   - **Web App URL**ï¼šç²˜è´´åˆšæ‰å¤åˆ¶çš„ URL
   - **æäº¤äººåç§°**ï¼šè¾“å…¥ä½ çš„åå­—ï¼ˆå¦‚ï¼šå°æ˜ï¼‰
   - **å¯ç”¨è‡ªåŠ¨ä¿å­˜**ï¼šå‹¾é€‰åå¤„ç†å®Œæˆä¼šè‡ªåŠ¨ä¿å­˜
5. ç‚¹å‡» **æµ‹è¯•è¿æ¥** éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®

---

## ä¸‰ã€ä½¿ç”¨æ–¹å¼

### è‡ªåŠ¨ä¿å­˜
å¯ç”¨"è‡ªåŠ¨ä¿å­˜"åï¼Œæ¯æ¬¡å¤„ç†å®Œæˆä¼šè‡ªåŠ¨ä¿å­˜åˆ°è¡¨æ ¼ã€‚

### æ‰‹åŠ¨ä¿å­˜
åœ¨ç»“æœåŒºåŸŸæ‰¾åˆ° **ä¿å­˜åˆ°è¡¨æ ¼** æŒ‰é’®ï¼Œç‚¹å‡»å³å¯ä¿å­˜ã€‚

---

## å››ã€æ•°æ®å­˜å‚¨æ ¼å¼

åˆ†é¡µä¼šè‡ªåŠ¨åˆ›å»ºï¼Œæ ¼å¼ä¸ºï¼š`{æäº¤äºº}-{åŠŸèƒ½å}`

### AI å›¾ç‰‡è¯†åˆ«
åˆ†é¡µåç§°ï¼š`{æäº¤äºº}-å›¾ç‰‡è¯†åˆ«`

| æ—¶é—´ | å›¾ç‰‡é“¾æ¥ | å›¾ç‰‡å…¬å¼ | è¯†åˆ«ç»“æœ |
|------|----------|----------|----------|
| 2026-02-01 12:00 | https://... | =IMAGE("...") | è¯†åˆ«å†…å®¹ |

### æç¤ºè¯å·¥å…·
åˆ†é¡µåç§°ï¼š`{æäº¤äºº}-æç¤ºè¯`

| æ—¶é—´ | æ¨¡å¼ | åŸæ–‡ | ç”Ÿæˆç»“æœ |
|------|------|------|----------|
| 2026-02-01 12:00 | åˆ›æ–°æ¨¡å¼ | åŸå§‹å†…å®¹ | ç”Ÿæˆç»“æœ |

### æ‰¹é‡ç¿»è¯‘
åˆ†é¡µåç§°ï¼š`{æäº¤äºº}-ç¿»è¯‘`

| æ—¶é—´ | ç›®æ ‡è¯­è¨€ | åŸæ–‡ | ç¿»è¯‘ç»“æœ |
|------|----------|------|----------|
| 2026-02-01 12:00 | English | ä¸­æ–‡å†…å®¹ | English content |

### ä¸“ä¸šæŸ¥é‡
åˆ†é¡µåç§°ï¼š`{æäº¤äºº}-æŸ¥é‡`

| æ—¶é—´ | åŸæ–‡ | æ”¹å†™ç»“æœ | ç›¸ä¼¼åº¦ |
|------|------|----------|--------|
| 2026-02-01 12:00 | åŸå§‹æ–‡æœ¬ | æ”¹å†™æ–‡æœ¬ | 15% |

---

## äº”ã€å¸¸è§é—®é¢˜

### Q: ä¿å­˜å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
1. æ£€æŸ¥ Web App URL æ˜¯å¦æ­£ç¡®
2. ç‚¹å‡»"æµ‹è¯•è¿æ¥"æŒ‰é’®éªŒè¯
3. ç¡®ä¿ Apps Script å·²æ­£ç¡®éƒ¨ç½²

### Q: åˆ†é¡µæ²¡æœ‰è‡ªåŠ¨åˆ›å»ºï¼Ÿ
ç¡®ä¿ä½¿ç”¨çš„æ˜¯ v3.1 ç‰ˆæœ¬çš„ GAS ä»£ç ï¼Œæ—§ç‰ˆæœ¬ä¸æ”¯æŒè‡ªåŠ¨åˆ›å»ºåˆ†é¡µã€‚

### Q: å¯ä»¥ä¿®æ”¹åˆ†é¡µåç§°å—ï¼Ÿ
åˆ†é¡µåç§°æ ¼å¼å›ºå®šä¸º `{æäº¤äºº}-{åŠŸèƒ½å}`ï¼Œä¿®æ”¹æäº¤äººåç§°å³å¯æ›´æ”¹åˆ†é¡µåç§°ã€‚

### Q: è®¾ç½®ä¼šè·¨è®¾å¤‡åŒæ­¥å—ï¼Ÿ
ä¸ä¼šã€‚è®¾ç½®ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ï¼Œæ¯å°è®¾å¤‡éœ€è¦å•ç‹¬é…ç½®ã€‚

### Q: å·²æœ‰çš„ GAS ä»£ç éœ€è¦æ›¿æ¢å—ï¼Ÿ
æ˜¯çš„ï¼Œéœ€è¦ä½¿ç”¨ä¸Šé¢çš„ v3.1 å®Œæ•´ç‰ˆä»£ç æ›¿æ¢ã€‚æ–°ä»£ç **å®Œå…¨å…¼å®¹**åŸæœ‰åŠŸèƒ½ï¼ŒåŒæ—¶å¢åŠ äº†è‡ªåŠ¨åˆ›å»ºåˆ†é¡µçš„èƒ½åŠ›ã€‚

---

## å…­ã€æ›´æ–° Apps Script

å¦‚æœéœ€è¦æ›´æ–° GAS ä»£ç ï¼š
1. æ‰“å¼€ Apps Script ç¼–è¾‘å™¨
2. æ›¿æ¢ä»£ç 
3. ç‚¹å‡» **éƒ¨ç½² â†’ ç®¡ç†éƒ¨ç½²**
4. ç‚¹å‡»é“…ç¬”å›¾æ ‡ç¼–è¾‘
5. ç‰ˆæœ¬é€‰æ‹© **æ–°ç‰ˆæœ¬**
6. ç‚¹å‡» **éƒ¨ç½²**

âš ï¸ **æ³¨æ„ï¼šæ¯æ¬¡ä¿®æ”¹ä»£ç åéƒ½éœ€è¦åˆ›å»ºæ–°ç‰ˆæœ¬æ‰èƒ½ç”Ÿæ•ˆï¼**

---

## ä¸ƒã€ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | æ›´æ–°å†…å®¹ |
|------|------|----------|
| v3.1 | 2026-02-01 | æ–°å¢è‡ªåŠ¨åˆ›å»ºåˆ†é¡µå’Œè¡¨å¤´åŠŸèƒ½ |
| v3.0 | - | åŸå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒåŸºæœ¬è¯»å†™æ“ä½œ |
