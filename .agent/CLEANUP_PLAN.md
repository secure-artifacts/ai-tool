# 🧹 ITEN AI 工具包 - 代码整理计划

> 生成时间: 2026-01-30
> 目标: 在不改变核心功能的前提下，提升代码可读性、可维护性和结构合理性

---

## 📊 项目现状诊断

### 规模统计
| 指标 | 数值 |
|------|------|
| TSX 文件总数 | 145+ |
| TSX 代码行数 | ~85,700 行 |
| CSS 代码行数 | ~23,300 行 |
| 大文件 (>500行) | 15+ 个 |

### 代码质量指标
| 指标 | 当前值 | 目标值 | 优先级 |
|------|--------|--------|--------|
| 内联样式 | 213 | <50 | 🔶 中 |
| console.log | 530 | <50 | 🔴 高 |
| any 类型 | 162 | <30 | 🔶 中 |
| TODO/FIXME | 0 | - | ✅ 良好 |

### 🔥 重灾区文件 (需优先处理)
| 文件 | 行数 | 问题 |
|------|------|------|
| `MediaGalleryPanel.tsx` | 11,826 | 超大文件，需拆分 |
| `index.tsx` | 9,292 | 主入口过于臃肿 |
| `TransposePanel.tsx` | 3,928 | 大型组件 |
| `ResultsGrid.tsx` | 3,221 | 复杂渲染逻辑 |
| `SmartTranslateApp.tsx` | 3,096 | 功能耦合 |

---

## ✅ 准备工作清单

### 1. 安全网 (必须)

- [ ] **创建整理分支**
  ```bash
  git checkout -b feature/cleanup-2026
  ```

- [ ] **确保构建通过**
  ```bash
  npm run build
  ```

- [ ] **备份当前状态**
  ```bash
  git tag backup-before-cleanup-$(date +%Y%m%d)
  ```

### 2. 全局视图 (推荐)

- [ ] **生成目录结构图** → 已有 `ARCHITECTURE.md` 在知识库中
- [ ] **识别模块依赖关系**
- [ ] **标记核心 vs 辅助模块**

### 3. 风格指南 (推荐)

- [ ] **设置 .cursorrules** (如果使用 Cursor)
- [ ] **选择示例文件 (Golden Sample)**
  - 建议: `apps/ai-mind-map/components/InputPanel.tsx` (0 内联样式)
  - 建议: `components/LoginModal.css` (良好的 CSS 组织)

---

## 📋 整理步骤 (按顺序执行)

### 第一阶段: 清理冗余 (低风险)

| 任务 | 命令/方法 | 预计时间 |
|------|----------|----------|
| 移除 console.log | `grep -r 'console\.' --include='*.tsx'` | 1-2h |
| 清理未使用的导入 | ESLint/IDE 自动修复 | 30min |
| 统一代码格式 | Prettier | 15min |

### 第二阶段: 样式统一 (中风险)

| 任务 | 当前进度 | 目标 |
|------|----------|------|
| 内联样式迁移 | 213 → 目标 <50 | 75%+ 完成 |
| CSS 变量统一 | 部分完成 | 100% |
| 主题一致性 | 良好 | 保持 |

### 第三阶段: 模块拆分 (高风险)

| 大文件 | 建议拆分方案 |
|--------|------------|
| `MediaGalleryPanel.tsx` (11k行) | 拆分为: `GalleryGrid`, `GalleryFilters`, `GalleryToolbar`, `GalleryItem` |
| `index.tsx` (9k行) | 拆分为: `AppRouter`, `AppLayout`, `AppProviders` |
| `TransposePanel.tsx` (4k行) | 拆分为: `TransposeControls`, `TransposePreview`, `TransposeHistory` |

### 第四阶段: 类型强化 (中风险)

| 任务 | 当前 | 目标 |
|------|------|------|
| any 类型替换 | 162 | <30 |
| 接口定义补全 | 部分 | 100% |
| 泛型优化 | 基础 | 高级 |

---

## 🎯 AI 协作指令模板

### 清理 console.log
```
扫描 [文件路径]，识别所有 console.log/console.warn/console.error 调用：
1. 保留错误处理中必要的 console.error
2. 移除调试用的 console.log
3. 将重要日志替换为可配置的 logger 函数
```

### 模块拆分
```
分析 [大文件]，将其按功能职责拆分：
1. 识别独立的 UI 组件
2. 提取可复用的 hooks
3. 分离数据处理逻辑
4. 保持原有的导出接口不变
```

### 类型强化
```
为 [文件] 中的 any 类型添加具体类型定义：
1. 分析变量的实际使用方式
2. 创建必要的 interface/type
3. 确保类型推导正确
```

---

## 📅 建议时间线

| 阶段 | 预计时间 | 里程碑 |
|------|----------|--------|
| 准备工作 | 1 天 | 分支创建、备份完成 |
| 第一阶段 (清理冗余) | 2-3 天 | console.log <50 |
| 第二阶段 (样式统一) | 3-5 天 | 内联样式 <50 |
| 第三阶段 (模块拆分) | 5-7 天 | 大文件拆分完成 |
| 第四阶段 (类型强化) | 3-4 天 | any 类型 <30 |
| **总计** | **~3 周** | |

---

## ⚠️ 注意事项

1. **每步都验证构建**: 每完成一个小任务就运行 `npm run build`
2. **小步提交**: 每个有意义的改动都单独提交
3. **保持可回滚**: 复杂改动前打 tag
4. **视觉验证**: 样式改动后在浏览器中确认外观无变化
5. **优先修复 Bug**: 如果发现 Bug，先修复再继续整理

---

## 🔗 相关资源

- 知识库: `ITEN AI Toolkit Ecosystem` (v2.9.7)
- CSS 设计系统: `index.css`
- 组件库: `components/`
