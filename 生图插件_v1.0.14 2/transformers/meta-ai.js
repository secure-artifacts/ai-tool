(function(){"use strict";function S(u){return{all:u=u||new Map,on:function(t,i){var o=u.get(t);o?o.push(i):u.set(t,[i])},off:function(t,i){var o=u.get(t);o&&(i?o.splice(o.indexOf(i)>>>0,1):u.set(t,[]))},emit:function(t,i){var o=u.get(t);o&&o.slice().map(function(c){c(i)}),(o=u.get("*"))&&o.slice().map(function(c){c(t,i)})}}}function M(u,t){const i=o=>{t(o),window.emitter.off(u,i)};window.emitter.on(u,i)}const C=S();window.emitter=C;function P(){window.currentProcess={row:null,prompt:"",folder:""};const u=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(t){if(t instanceof FormData&&t.get("fb_api_req_friendly_name")==="useKadabraSendMessageMutation"&&window.currentProcess.row!=null){const i={...window.currentProcess};this.addEventListener("load",()=>{try{const o=JSON.parse(this.responseText);console.log("返回的body是：",o);const c=o?.data?.xfb_silverstone_send_message?.bot_response_message?.id;c&&(console.log("返回的id是：",c),window.emitter.emit("onSubmitSuccess",{id:c,...i}))}catch(o){console.error(this.responseText,"解析响应体出错：",o)}})}return u.call(this,t)}}(function(){(function(){(t=>{var i,o;if(t.__fbModulesReplacementInjected)return;t.__fbModulesReplacementInjected=!0,window.simpleReplacefunctions=(i=window.simpleReplacefunctions)!=null?i:{},window.moduleProxyArr=(o=window.moduleProxyArr)!=null?o:[];function c(e,r){if(window.simpleReplacefunctions[e])return window.simpleReplacefunctions[e];for(let n=0;n<window.moduleProxyArr.length;n++){const s=window.moduleProxyArr[n](e,r);if(s!==r)return s}return r}var m=window.__d;m?m.toString().includes("__d_stub")?(delete window.__d,y(),window.__d=m):window.__d=function(e,r,n,s){const p=arguments[2];return arguments[2]=c(e,p),m.apply(null,arguments)}:y();function y(){Object.defineProperty(window,"__d",{get:function(){return m},set:function(e){typeof e=="function"&&!e.toString().includes("__d_stub.push")?m=function(r,n,s,p){const h=arguments[2];return arguments[2]=c(r,h),e.apply(null,arguments)}:m=e}})}window.eventListeners={box:{},waitMount:{},compmentStates:{},add:(e,r)=>{if(window.eventListeners.box[e]||(window.eventListeners.box[e]=[]),window.eventListeners.box[e].push(r),window.eventListeners.waitMount[e]!==void 0){let n=window.eventListeners.waitMount[e];delete window.eventListeners.waitMount[e],setTimeout(()=>{window.eventListeners.fire(e,n)},0)}return()=>{window.eventListeners.box[e]=window.eventListeners.box[e].filter(n=>n!==r)}},fire:(e,r)=>{window.eventListeners.box[e]?window.eventListeners.box[e].forEach(n=>{n(r)}):window.eventListeners.waitMount[e]=r}},window.heroReplace={normal_replace:function(e,r,n){return function(s,p,h,l){s=Object.assign({},s,p,h);const g=!!window.eventListeners.compmentStates[n];var[f,w]=r.useState(window.heroReplace[n+"_proxy"]?g:!1);return r.useEffect(()=>window.eventListeners.add(n,a=>{window.eventListeners.compmentStates[n]=!!a,w(!!a)}),[w,n]),f&&window.heroReplace[n+"_proxy"]?r.jsx(window.heroReplace[n+"_proxy"],{props:s,sourcefunc:e,sourcename:n}):r.createElement(e,s)}}},t.__dr=function(e,r,n){var s;t.simpleReplacefunctions=(s=t.simpleReplacefunctions)!=null?s:{},t.simpleReplacefunctions[e]||(t.simpleReplacefunctions[e]=n)},t.__drop=function(e,r,n){}})(window)})(),window.moduleProxyArr.push((t,i)=>{switch(t){case"KadabraComposer.react":return function(o,c,m,y,e,r,n,s,p,h,l,g,f,w){if(i.apply(this,arguments),arguments[6]&&arguments[6].default){const a=arguments[6].default,d=window.require("react");arguments[6].default=function(_){window.require("react").useEffect(()=>{const b=_.attachments?.[0];b&&window.currentProcess.filename===b.file?.name&&!b.uploading&&(b.uploadFailureReason?window.emitter.emit("onUploadImageFinish",b.uploadFailureReason):b.imagineMetadata?.mediaID&&window.emitter.emit("onUploadImageFinish"))},[_.attachments]);const{selectedCreateType:R,setSelectedCreateType:v}=window.require("KadabraModelSelectorContext.react").useKadabraModelSelectorContext();return _&&_.onChange&&_.onSubmit&&(window.generate=window.generateVideo=_.onSubmit,window.setCreateType=v),d.createElement(a,_)}}else console.log(t+" 发生错误:",arguments)};case"MLCContentEditable.react":return function(o,c,m,y,e,r,n,s,p,h,l,g,f,w){if(i.apply(this,arguments),arguments[6]&&arguments[6].default){const a=arguments[6].default,d=window.require("react");arguments[6].default=function(_){const R=window.require("LexicalComposerContext").useLexicalComposerContext()[0];return window.setPrompt=v=>{R.update(()=>{const{$getRoot:b,$createParagraphNode:q,$createTextNode:E}=window.require("Lexical"),L=b();L.clear(),L.append(q().append(E(v)))})},d.createElement(a,_)}}else console.log(t+" 发生错误:",arguments)};case"KadabraComposerUploadAttachmentWithNuxButton.react":return function(o,c,m,y,e,r,n){if(i.apply(this,arguments),arguments[6]&&arguments[6].default){const s=arguments[6].default,p=window.require("react");arguments[6].default=function(l){return l&&l.onFilesSelected&&!window.uploadImage&&(window.uploadImage=async g=>{const f=new Promise(w=>{M("onUploadImageFinish",a=>{w(a||"")})});return l.onFilesSelected(g),f}),p.createElement(s,l)}}else console.log(t+" 发生错误:",arguments)};case"RequestStreamHandler":return function(o,c,m,y,e,r,n){if(i.apply(this,arguments),arguments[6]&&arguments[6].default){const s=arguments[6].default,p=s.prototype.onData;s.prototype.onData=function(h){try{const l=JSON.parse(h);console.log(l);const g=l?.data?.xfb_llm_async_response_subscription?.message,f=g?.id;if(f){let w;if(g.imagine_card){const a=l?.extensions?.prefetch_uris_v2;if(f&&Array.isArray(a)){const d=a.map(x=>x.uri).filter(Boolean);d.length===4&&(w={[f]:d.map(x=>({url:x,thumbnail:x}))})}}else{const a=g?.generated_media?.media;Array.isArray(a)&&a.length&&a.every(d=>d.generation_status.status.toUpperCase()==="COMPLETE"&&d.uri&&d.input_image_uri)&&(w={[f]:a.map(d=>({url:d.uri,thumbnail:d.input_image_uri}))})}w&&(console.log("提取的链接是：",w),window.emitter.emit("onReceiveData",w))}}catch(l){console.error("解析数据出错：",l)}return p.apply(this,arguments)}}else console.log(t+" 发生错误:",arguments)};default:return i}}),P()})()})();
