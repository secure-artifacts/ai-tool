(function(){"use strict";function b(t){return new Promise(r=>setTimeout(r,t*1e3))}function S(t,r,i=100,o=1e3){if(typeof t!="function"||typeof r!="function"){console.log("错误");return}let n=0,a=null;function l(){if(a&&clearTimeout(a),n++,n>i)return r(!1);if(t())return r(!0);a=setTimeout(()=>{l()},o)}l()}async function L(t){let r;const i=t.headers.get("Content-Type")||"";try{if(i.includes("application/json"))r=await t.json();else if(i.includes("text/")){let o=await t.text();o=o.replace(/^for\s*\(\s*;;\s*\);/,"").trim();try{r=JSON.parse(o)}catch{r=o}}else if(i.includes("application/octet-stream")||i.includes("blob"))r=await t.blob();else if(i.includes("form-data"))r=await t.formData();else{let o=await t.text();try{r=JSON.parse(o)}catch{r=o}}}catch{}return r}const M="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let R=(t=21)=>{let r="",i=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)r+=M[i[t]&63];return r};window.currentProcess={row:null,prompt:"",folder:""},window.videoStorage=[],window.authorization="";function j(){const t=window.fetch;window.fetch=async(r,i)=>{const o=C(r),n={...window.currentProcess},a=o.includes("uploadUserImage")&&n.row!=null,l=o.includes("flowMedia:batchGenerateImages")&&n.row!=null,p=a||l,e=R();l&&(console.log("返回的id是：",e),window.emitter.emit("onSubmitSuccess",{...n,id:e}));const s=await t(r,i);if(p)try{const c=s.clone(),u=await L(c);if(u){if(a)u.mediaGenerationId?.mediaGenerationId?window.emitter.emit("onUploadImageFinish"):window.emitter.emit("onUploadImageFinish","上传文件出错："+JSON.stringify(u));else if(l){const w=u.media;if(Array.isArray(w)&&w.length){const m=w.map(d=>d?.image?.generatedImage?.fifeUrl).filter(Boolean);if(m.length){const d={[e]:m.map(f=>({url:f,thumbnail:f}))};window.emitter.emit("onReceiveData",d)}}}}}catch(c){console.error(c)}return s}}function C(t){return typeof t=="string"?t:t instanceof URL?t.href:t instanceof Request?t.url:String(t??"")}function N(t,r){if(window.modulefactory)return;const i=Object.keys(t)[0],o=t[i];console.log("找到------------------module"),t[i]=function(){window.modulefactory=arguments[2],o.apply(this,arguments)}}function T(t){return{all:t=t||new Map,on:function(r,i){var o=t.get(r);o?o.push(i):t.set(r,[i])},off:function(r,i){var o=t.get(r);o&&(i?o.splice(o.indexOf(i)>>>0,1):t.set(r,[]))},emit:function(r,i){var o=t.get(r);o&&o.slice().map(function(n){n(i)}),(o=t.get("*"))&&o.slice().map(function(n){n(r,i)})}}}function O(t,r){const i=o=>{r(o),window.emitter.off(t,i)};window.emitter.on(t,i)}const F=T();window.emitter=F;function P(){S(()=>window.require("jsx").jsx,t=>{if(!t)return;console.log("找到------------------jsx");const r=window.require("jsx").jsx;window.require("jsx").jsx=function(o,n){return n?.onChange&&n.onSubmit?(window.generate=n.onSubmit,window.setPrompt=a=>{n.onChange({target:{value:a}})}):n?.options?.find?.(a=>a.value==="IMAGE_GENERATION")&&n.onValueChange?window.setCreateType=async a=>{n.onValueChange("IMAGE_GENERATION")}:n?.onEmptyClick&&n.onDelete?x=n.onEmptyClick:n?.type==="file"&&n?.onChange&&(v=n.onChange),r(...arguments)};const i=window.require("jsx").jsxs;window.require("jsx").jsxs=function(o,n){return n?.children?.[0]?.props?.icon==="crop"&&n.type==="button"&&n.onClick&&(y=()=>{n.onClick({defaultPrevented:!1})}),i(...arguments)}},1e3,100)}let y,v,x;window.uploadImage=async t=>{if(!x||(x(),await b(1),!v))return"找不到上传文件按钮";if(v({target:{files:t}}),await b(3),!y)return"找不到确定剪裁按钮";const r=new Promise(i=>{O("onUploadImageFinish",o=>{i(o)})});return y(),r};const g={Modules:[]};function U(){if(!window.modulefactory)return;console.log("刷新数据","modulefactory"),g.Modules=Object.keys(window.modulefactory.m).map(o=>{var n=null;try{n=window.modulefactory(o)}catch{}return n});const t=function(n){return window.modulefactory(n)},r=function(n){var a=[];return g.Modules.forEach(function(l){if(typeof l<"u")if(typeof n=="string"){if(typeof l.default=="object")for(const p in l.default)p==n&&a.push(l);for(const p in l)p==n&&a.push(l)}else if(typeof n=="function")n(l)&&a.push(l);else throw"沒有模塊"}),a},i=function(o){if(g.Modules==0)throw Error("沒有模塊");var n=[];if(typeof o=="string")g.Modules.forEach(function(a){a.toString().includes(o)&&n.push(a)});else if(typeof o=="function")g.Modules.forEach(function(a){o(a)&&n.push(a)});else throw Error("沒有模塊");return n};window.moduleManager={modules:g.Modules,findModule:r,findFunction:i,get:window.modulefactory?t:null}}if(window.webpackChunk_N_E)console.log("已经存在 webpackChunk_N_E");else{let t=function(e){replaceIds.length&&replaceIds.forEach(s=>{n[s]?n[s](e,fbmodules):window.replaceIds=window.replaceIds.filter(c=>c!==s)})},r=function(e){const s=e.id;n[s]=e,replaceIds.push(s)};console.log("不存在 webpackChunk_N_E");const i=Function.prototype.toString;window.originalToString=i,window.webpackChunk_N_E=[];let o=window.webpackChunk_N_E.push;window.eventListeners||(window.eventListeners={box:{},waitMount:{},componentStates:{},add:(e,s)=>{if(eventListeners.box[e]||(eventListeners.box[e]=[]),eventListeners.box[e].push(s),eventListeners.waitMount[e]!==void 0){let c=eventListeners.waitMount[e];delete eventListeners.waitMount[e],setTimeout(()=>{eventListeners.fire(e,c)},0)}return()=>{eventListeners.box[e]=eventListeners.box[e].filter(c=>c!==s)}},fire:(e,s)=>{eventListeners.box[e]?eventListeners.box[e].length>0?eventListeners.box[e].forEach(c=>{c(s)}):eventListeners.componentStates[e]=!!s:eventListeners.waitMount[e]=s}}),window.heroReplace||(window.heroReplace={node_replace:function(e,s,c,u){return u.createElement(function(){const m=!!eventListeners.componentStates[e];var[d,f]=u.useState(heroReplace[e+"_proxy"]?m:!1);return u.useEffect(()=>eventListeners.add(e,h=>{eventListeners.componentStates[e]=!!h,f(!!h)}),[f,e]),d&&heroReplace[e+"_proxy"]?u.createElement(heroReplace[e+"_proxy"],{sourceNode:s,mode:c,moduleId:e}):s},{})},memo_replace:function(e,s){var c=window.require("react");return c?.memo?c.memo(function(u,w,m,d){console.log(2,arguments);let f=Object.assign({},u,w,m,d);const h=!!eventListeners.componentStates[e];var[A,E]=c.useState(heroReplace[e+"_proxy"]?h:!1);return c.useEffect(()=>eventListeners.add(e,_=>{eventListeners.componentStates[e]=!!_,E(!!_)}),[E,e]),A&&heroReplace[e+"_proxy"]?c.createElement(heroReplace[e+"_proxy"],{sourcefunc:s,props:f,moduleId:e}):c.createElement(s,f)}):(console.log("替换失败",e),s)},module_replace:function(e,s){var c=window.require("react");return!c||!c.createElement?(console.log("没有，react"),s):function(w){const m=!!eventListeners.componentStates[e];var[d,f]=c.useState(heroReplace[e+"_proxy"]?m:!1);return c.useEffect(()=>eventListeners.add(e,h=>{eventListeners.componentStates[e]=!!h,f(!!h)}),[f,e]),d&&heroReplace[e+"_proxy"]?c.createElement(heroReplace[e+"_proxy"],{props:w,sourcefunc:s,mouldeId:e}):c.createElement(s,w)}}}),window.fbmodules={};let n={};window.replaceIds=[],window.require=function(e){if(!fbmodules[e]){if(!window.moduleManager)return{};let s=window.moduleManager.findModule(k[e]);if(!s?.[0])return{};fbmodules[e]=s?.[0]}return fbmodules[e]};let a=0;const l={0:o};let p;Object.defineProperty(webpackChunk_N_E,"push",{get:()=>{if(a>0){const e=a;return function(){t(arguments[0][1]),clearTimeout(p),p=setTimeout(()=>{U()},1e3),l[e].apply(webpackChunk_N_E,arguments)}}return o},set:e=>{a++,l[a]=e}}),r(N),P()}j();const k={react:t=>t&&t.createElement,"react-dom":t=>t&&t.hydrateRoot&&t.render,jsx:t=>t.jsx}})();
