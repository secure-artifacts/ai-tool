(function(){"use strict";const g="react";v.id=g;function v(t,i){const o=Object.entries(t).find(n=>n[1]&&originalToString.call(n[1]).includes(".createElement="));if(o){window.replaceIds=window.replaceIds.filter(a=>a!==g);const n=t[o[0]];t[o[0]]=function(){window.modulefactory=arguments[2],n.apply(this,arguments),console.log("找到------------------",g),i[g]=arguments[0].exports}}}function S(t){return typeof t=="string"?t:t instanceof URL?t.href:t instanceof Request?t.url:String(t??"")}function _(t){return new Promise(i=>setTimeout(i,t*1e3))}async function L(t){let i;const o=t.headers.get("Content-Type")||"";try{if(o.includes("application/json"))i=await t.json();else if(o.includes("text/")){let n=await t.text();n=n.replace(/^for\s*\(\s*;;\s*\);/,"").trim();try{i=JSON.parse(n)}catch{i=n}}else if(o.includes("application/octet-stream")||o.includes("blob"))i=await t.blob();else if(o.includes("form-data"))i=await t.formData();else{let n=await t.text();try{i=JSON.parse(n)}catch{i=n}}}catch{}return i}function R(t){return{all:t=t||new Map,on:function(i,o){var n=t.get(i);n?n.push(o):t.set(i,[o])},off:function(i,o){var n=t.get(i);n&&(o?n.splice(n.indexOf(o)>>>0,1):t.set(i,[]))},emit:function(i,o){var n=t.get(i);n&&n.slice().map(function(a){a(o)}),(n=t.get("*"))&&n.slice().map(function(a){a(i,o)})}}}function E(t,i){const o=n=>{i(n),window.emitter.off(t,o)};window.emitter.on(t,o)}const j=R();window.emitter=j;const h="jsx";b.id=h;function b(t,i){const o=Object.entries(t).find(n=>n[1]&&originalToString.call(n[1]).includes(".jsx="));if(o){window.replaceIds=window.replaceIds.filter(a=>a!==h);const n=t[o[0]];t[o[0]]=function(){window.modulefactory=arguments[2],n.apply(this,arguments),console.log("找到------------------",h),i[h]=arguments[0].exports;const a=arguments[0].exports.jsx;arguments[0].exports.jsx=function(d,c){return c?.onPromptChange&&c.onSubmit?(window.setPrompt=e=>{c.onPromptChange(e)},window.generate=c.onSubmit):c?.onFilesSelected?window.uploadImage=e=>{const r=new Promise(s=>{E("onUploadImageFinish",f=>{s(f)})});return c.onFilesSelected(e),r}:c?.images&&c.onRemove&&(window.uploadedImages=c.images,window.clearUploadedImages=async()=>{if(window.uploadedImages?.length){for(let e=window.uploadedImages.length-1;e>=0;e--)c.onRemove(e),await _(1);window.uploadedImages=[]}}),a.apply(this,arguments)}}}}window.currentProcess={row:null,prompt:"",folder:"",filename:[]},window.videoStorage=[],window.authorization="";function P(){const t=window.fetch;window.fetch=async(i,o)=>{const n=S(i),a={...window.currentProcess},d=n.includes("api/assets")&&a.row!=null,c=n.includes("generations/batch")&&a.row!=null,e=n.includes("generations")&&!n.includes("generations/batch"),r=d||c||e,s=await t(i,o);if(r)try{const f=s.clone(),l=await L(f);if(l){if(d){const w=l.metadata?.fileName;w?(window.currentProcess.filename=window.currentProcess.filename.filter(u=>u!==w),window.currentProcess.filename.length||window.emitter.emit("onUploadImageFinish")):window.emitter.emit("onUploadImageFinish","上传文件出错："+JSON.stringify(l))}else if(c){if(Array.isArray(l)&&l.length)for(const w of l){const u=w.id;u&&window.emitter.emit("onSubmitSuccess",{...a,id:u})}}else if(e&&l.data?.status?.toLowerCase?.()==="ready"){const w=l.data?.id,u=l.data.raw_url_signed;w&&u&&window.emitter.emit("onReceiveData",{[w]:[{url:u,thumbnail:u}]})}}}catch(f){console.error(f)}return s}}if(window.webpackChunk_N_E)console.log("已经存在 webpackChunk_N_E");else{let t=function(e){replaceIds.length&&replaceIds.forEach(r=>{a[r]?a[r](e,fbmodules):window.replaceIds=window.replaceIds.filter(s=>s!==r)})},i=function(e){const r=e.id;a[r]=e,replaceIds.push(r)};console.log("不存在 webpackChunk_N_E");const o=Function.prototype.toString;window.originalToString=o,window.webpackChunk_N_E=[];let n=window.webpackChunk_N_E.push;window.eventListeners||(window.eventListeners={box:{},waitMount:{},componentStates:{},add:(e,r)=>{if(eventListeners.box[e]||(eventListeners.box[e]=[]),eventListeners.box[e].push(r),eventListeners.waitMount[e]!==void 0){let s=eventListeners.waitMount[e];delete eventListeners.waitMount[e],setTimeout(()=>{eventListeners.fire(e,s)},0)}return()=>{eventListeners.box[e]=eventListeners.box[e].filter(s=>s!==r)}},fire:(e,r)=>{eventListeners.box[e]?eventListeners.box[e].length>0?eventListeners.box[e].forEach(s=>{s(r)}):eventListeners.componentStates[e]=!!r:eventListeners.waitMount[e]=r}}),window.heroReplace||(window.heroReplace={node_replace:function(e,r,s,f){return f.createElement(function(){const w=!!eventListeners.componentStates[e];var[u,p]=f.useState(heroReplace[e+"_proxy"]?w:!1);return f.useEffect(()=>eventListeners.add(e,m=>{eventListeners.componentStates[e]=!!m,p(!!m)}),[p,e]),u&&heroReplace[e+"_proxy"]?f.createElement(heroReplace[e+"_proxy"],{sourceNode:r,mode:s,moduleId:e}):r},{})},memo_replace:function(e,r){var s=window.require("react");return s?.memo?s.memo(function(f,l,w,u){console.log(2,arguments);let p=Object.assign({},f,l,w,u);const m=!!eventListeners.componentStates[e];var[F,x]=s.useState(heroReplace[e+"_proxy"]?m:!1);return s.useEffect(()=>eventListeners.add(e,y=>{eventListeners.componentStates[e]=!!y,x(!!y)}),[x,e]),F&&heroReplace[e+"_proxy"]?s.createElement(heroReplace[e+"_proxy"],{sourcefunc:r,props:p,moduleId:e}):s.createElement(r,p)}):(console.log("替换失败",e),r)},module_replace:function(e,r){var s=window.require("react");return!s||!s.createElement?(console.log("没有，react"),r):function(l){const w=!!eventListeners.componentStates[e];var[u,p]=s.useState(heroReplace[e+"_proxy"]?w:!1);return s.useEffect(()=>eventListeners.add(e,m=>{eventListeners.componentStates[e]=!!m,p(!!m)}),[p,e]),u&&heroReplace[e+"_proxy"]?s.createElement(heroReplace[e+"_proxy"],{props:l,sourcefunc:r,mouldeId:e}):s.createElement(r,l)}}}),window.fbmodules={};let a={};window.replaceIds=[],window.require=function(e){if(!fbmodules[e]){if(!window.moduleManager)return{};let r=window.moduleManager.findModule(C[e]);if(!r?.[0])return{};fbmodules[e]=r?.[0]}return fbmodules[e]};let d=0;const c={0:n};Object.defineProperty(webpackChunk_N_E,"push",{get:()=>{if(d>0){const e=d;return function(){t(arguments[0][1]),c[e].apply(webpackChunk_N_E,arguments)}}return n},set:e=>{d++,c[d]=e}}),i(v),i(b)}P();const C={react:t=>t&&t.createElement,"react-dom":t=>t&&t.hydrateRoot&&t.render,jsx:t=>t.jsx}})();
