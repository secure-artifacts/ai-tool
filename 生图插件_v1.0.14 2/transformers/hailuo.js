(function(){"use strict";const C=[".png",".jpg",".jpeg",".webp"];function N(){window.currentProcess={row:null,prompt:"",folder:""};const s=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(c,l){const o=l.toString();if(c==="POST")if(o.includes("policy_callback"))this.addEventListener("load",()=>{try{const n=JSON.parse(this.responseText);console.log("返回的body是：",n);const r=n?.statusInfo?.message;r==="Success"?window.emitter.emit("onUploadImageFinish"):window.emitter.emit("onUploadImageFinish",r)}catch(n){console.error(this.response,"解析响应体出错：",n)}});else if(o.includes("subject/detect")&&location.href.includes("create/image-generation"))this.addEventListener("load",()=>{try{const n=JSON.parse(this.responseText);console.log("返回的body是：",n);const r=n?.statusInfo?.message;r==="Success"?window.emitter.emit("onUploadImageFinish"):r.includes("Please upload a clear front-facing photo for best result")?window.emitter.emit("onUploadImageFinish","无法识别面部"):window.emitter.emit("onUploadImageFinish",r)}catch(n){console.error(this.response,"解析响应体出错：",n)}});else if(o.includes("generate/video")&&window.currentProcess.row!=null){const n={...window.currentProcess};this.addEventListener("load",()=>{try{const r=JSON.parse(this.responseText);console.log("返回的body是：",r);const a=r?.data?.id;a&&(console.log("返回的id是：",a),window.emitter.emit("onSubmitSuccess",{id:a,...n}))}catch(r){console.error(this.responseText,"解析响应体出错：",r)}})}else if(o.includes("generate/image")&&window.currentProcess.row!=null){const n={...window.currentProcess};this.addEventListener("load",()=>{try{const r=JSON.parse(this.responseText);console.log("返回的body是：",r);const a=r?.data?.task?.videoIDs;if(a.length){console.log("返回的id是：",a);for(const t of a)window.emitter.emit("onSubmitSuccess",{id:t,...n})}}catch(r){console.error(this.responseText,"解析响应体出错：",r)}})}else o.includes("video/processing")&&this.addEventListener("load",()=>{try{const n=JSON.parse(this.responseText);console.log("返回的body是：",n);const r=n?.data?.batchVideos;if(Array.isArray(r)&&r.length){const a={};for(const t of r){const e=t.batchID;if(e){const i=t?.assets;if(Array.isArray(i)&&i.length){const d=i.reduce((f,u)=>{const w=u.downloadURL||"";return C.some(g=>w.includes(g))?a[u.id]=[{url:w,thumbnail:w}]:u.coverURL&&u.videoURL&&f.push({url:u.videoURL,thumbnail:u.coverURL}),f},[]);d.length&&(a[e]=d)}}}Object.keys(a).length&&(console.log("提取的视频链接是：",a),window.emitter.emit("onReceiveData",a))}}catch(n){console.error(this.responseText,"解析响应体出错：",n)}});return s.apply(this,arguments)}}const p={Modules:[]};function M(){if(!window.modulefactory)return;console.log("刷新数据","modulefactory"),p.Modules=Object.keys(window.modulefactory.m).map(o=>{var n=null;try{n=window.modulefactory(o)}catch{}return n});const s=function(n){return window.modulefactory(n)},c=function(n){var r=[];return p.Modules.forEach(function(a){if(typeof a<"u")if(typeof n=="string"){if(typeof a.default=="object")for(const t in a.default)t==n&&r.push(a);for(const t in a)t==n&&r.push(a)}else if(typeof n=="function")n(a)&&r.push(a);else throw"沒有模塊"}),r},l=function(o){if(p.Modules==0)throw Error("沒有模塊");var n=[];if(typeof o=="string")p.Modules.forEach(function(r){r.toString().includes(o)&&n.push(r)});else if(typeof o=="function")p.Modules.forEach(function(r){o(r)&&n.push(r)});else throw Error("沒有模塊");return n};window.moduleManager={modules:p.Modules,findModule:c,findFunction:l,get:window.modulefactory?s:null}}const y="react-dom";E.id=y;function E(s,c){const l=Object.entries(s).find(o=>o[1]&&originalToString.call(o[1]).includes(".render=")&&originalToString.call(o[1]).includes(".hydrateRoot="));if(l){window.replaceIds=window.replaceIds.filter(n=>n!==y);const o=s[l[0]];s[l[0]]=function(){o.apply(this,arguments),console.log("找到------------------",y),c[y]=arguments[0].exports}}}function h(s){return new Promise(c=>setTimeout(c,s*1e3))}function O(s){return{all:s=s||new Map,on:function(c,l){var o=s.get(c);o?o.push(l):s.set(c,[l])},off:function(c,l){var o=s.get(c);o&&(l?o.splice(o.indexOf(l)>>>0,1):s.set(c,[]))},emit:function(c,l){var o=s.get(c);o&&o.slice().map(function(n){n(l)}),(o=s.get("*"))&&o.slice().map(function(n){n(c,l)})}}}function P(s,c){const l=o=>{c(o),window.emitter.off(s,l)};window.emitter.on(s,l)}const j=O();window.emitter=j;const b="react";_.id=b;function _(s,c){const l=Object.entries(s).find(o=>o[1]&&originalToString.call(o[1]).includes(".createElement=")&&originalToString.call(o[1]).includes(".__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED="));if(l){console.log("找到------------------",b),window.replaceIds=window.replaceIds.filter(n=>n!==b);const o=s[l[0]];s[l[0]]=function(){window.modulefactory=arguments[2],o.apply(this,arguments);const n=arguments[0].exports.createElement;arguments[0].exports.createElement=function(a,t){if(t&&t?.beforeUpload&&t.onSuccess&&t.onError){window.uploadImage=async i=>{if(location.href.includes("image-to-video"))return e(i,"start");if(location.href.includes("image-generation"))return e(i)},window.uploadEndFrame=async i=>e(i,"end");async function e(i,d){if(d){if(d==="start"&&window.switchStart)window.switchStart();else if(d==="end"&&window.switchEnd)window.switchEnd();else return"无法切换模式";await h(1)}const f=new Promise(u=>{let w=!1;P("onUploadImageFinish",async m=>{w||(clearTimeout(g),window.confirmImage&&(await h(3),window.confirmImage(),await h(2)),u(m),w=!0)});let g=setTimeout(()=>{w||(u("请求超时"),w=!0)},6e4)});return t.beforeUpload(i[0],i),f}}return n.apply(this,arguments)};const r=arguments[0].exports.useMemo;arguments[0].exports.useMemo=function(a,t){if(Array.isArray(t?.[0])){const e=t[0]?.[0];e?.fileId&&e.url&&e.file_type&&e.uuid&&e.frameType!=null&&(window.uploadedImages=t[0])}return r.apply(this,arguments)},c[b]=arguments[0].exports}}}window.clearUploadedImages=async s=>{if(s==="video"){if(window.uploadedImages?.length&&window.handleDelete)for(const c of window.uploadedImages)window.handleDelete({stopPropagation:()=>{}},c.uuid),await h(1)}else if(window.onDelete){const c=window.uploadedImages?.length||1;for(let l=0;l<c;l++)window.onDelete(),await h(1);window.uploadedImages=[]}};const x="jsx";T.id=x;function T(s,c){const l=Object.entries(s).find(o=>o[1]&&originalToString.call(o[1]).includes(".jsx="));if(l){console.log("找到------------------",x),window.replaceIds=window.replaceIds.filter(n=>n!==x);const o=s[l[0]];s[l[0]]=function(){o.apply(this,arguments);const n=arguments[0].exports.jsx,r=arguments[0].exports.jsxs;arguments[0].exports.jsx=function(a,t){if(t?.onChange&&t.editor){const{editor:e}=t;window.setPrompt=function(i){!window.slate.insertNodes||!window.slate.removeNodes||(window.slate.removeNodes(e,{at:[0],voids:!0}),window.slate.insertNodes(e,[{type:"paragraph",children:[{text:i}]}],{at:[0]}),e.onChange())}}else if(t?.uploadedImages&&t.handleDelete)window.uploadedImages=t?.uploadedImages,window.handleDelete=t.handleDelete;else if(a==="button"&&t?.onClick&&t.children?.props?.children==="Confirm")window.confirmImage=t.onClick;else if(t?.localUploadedImages&&t.localUploadStatusInfo)window.localUploadedImages=t?.localUploadedImages,window.localUploadStatusInfo=t.localUploadStatusInfo;else if(t?.onDelete&&t.uploadSize)window.onDelete=function(){t.onDelete({stopPropagation:()=>{}})};else if(t?.handleRecreatePrompt&&!("loadMore"in t)&&!("preset"in t)){const e=t.handleRecreatePrompt;t.handleRecreatePrompt=function(i){return window.emitter.emit("addTextToCell",i),e.apply(this,arguments)}}else if(t?.onClick){const e=t.children?.props;if(e?.onPlay&&e?.getPopupContainer&&e.hoverTipText){const i=t.onClick;t.onClick=function(){return window.emitter.emit("addTextToCell",`[${e.hoverTipText}]`),i.apply(this,arguments)}}}else if(t?.handleOptionClick&&"selectedMotions"in t){const e=t.handleOptionClick;t.handleOptionClick=function(i){return i.label&&window.emitter.emit("addTextToCell",`[${i.label}]`),e.apply(this,arguments)}}return n.apply(this,arguments)},arguments[0].exports.jsxs=function(a,t){return a==="button"?t.onClick&&t?.children?.[0]?.props?.children?.length===3&&(window.generate=window.generateVideo=t.onClick):t.onClick&&t.children?.[1]?.props?.children==="Start"?window.switchStart=()=>t.onClick({stopPropagation:()=>{}}):t.onClick&&t.children?.[1]?.props?.children==="End"&&(window.switchEnd=()=>t.onClick({stopPropagation:()=>{}})),r.apply(this,arguments)},c[x]=arguments[0].exports}}}const v="slate";L.id=v,window.slate={};function L(s,c){const l=Object.entries(s).find(o=>o[1]&&originalToString.call(o[1]).includes("insertNodes:")&&originalToString.call(o[1]).includes("mergeNodes"));if(l){console.log("找到------------------",v),window.replaceIds=window.replaceIds.filter(n=>n!==v);const o=s[l[0]];s[l[0]]=function(){o.apply(this,arguments);const n=arguments[0].exports,r=Object.keys(n);r&&(arguments[0].exports=r.reduce((a,t)=>{const e=n[t];return e.removeNodes&&e.insertNodes&&(window.slate.removeNodes=e.removeNodes,window.slate.insertNodes=e.insertNodes),a[t]=e,a},{}),c[v]=arguments[0].exports)}}}if(window.webpackChunk_N_E)console.log("已经存在 webpackChunk_N_E");else{let s=function(e){replaceIds.length&&replaceIds.forEach(i=>{n[i]?n[i](e,fbmodules):window.replaceIds=window.replaceIds.filter(d=>d!==i)})},c=function(e){const i=e.id;n[i]=e,replaceIds.push(i)};console.log("不存在 webpackChunk_N_E");const l=Function.prototype.toString;window.originalToString=l,window.webpackChunk_N_E=[];let o=window.webpackChunk_N_E.push;window.eventListeners||(window.eventListeners={box:{},waitMount:{},componentStates:{},add:(e,i)=>{if(eventListeners.box[e]||(eventListeners.box[e]=[]),eventListeners.box[e].push(i),eventListeners.waitMount[e]!==void 0){let d=eventListeners.waitMount[e];delete eventListeners.waitMount[e],setTimeout(()=>{eventListeners.fire(e,d)},0)}return()=>{eventListeners.box[e]=eventListeners.box[e].filter(d=>d!==i)}},fire:(e,i)=>{eventListeners.box[e]?eventListeners.box[e].length>0?eventListeners.box[e].forEach(d=>{d(i)}):eventListeners.componentStates[e]=!!i:eventListeners.waitMount[e]=i}}),window.heroReplace||(window.heroReplace={node_replace:function(e,i,d,f){return f.createElement(function(){const w=!!eventListeners.componentStates[e];var[g,m]=f.useState(heroReplace[e+"_proxy"]?w:!1);return f.useEffect(()=>eventListeners.add(e,S=>{eventListeners.componentStates[e]=!!S,m(!!S)}),[m,e]),g&&heroReplace[e+"_proxy"]?f.createElement(heroReplace[e+"_proxy"],{sourceNode:i,mode:d,moduleId:e}):i},{})},memo_replace:function(e,i){var d=window.require("react");return d?.memo?d.memo(function(f,u,w,g){console.log(2,arguments);let m=Object.assign({},f,u,w,g);const S=!!eventListeners.componentStates[e];var[k,I]=d.useState(heroReplace[e+"_proxy"]?S:!1);return d.useEffect(()=>eventListeners.add(e,R=>{eventListeners.componentStates[e]=!!R,I(!!R)}),[I,e]),k&&heroReplace[e+"_proxy"]?d.createElement(heroReplace[e+"_proxy"],{sourcefunc:i,props:m,moduleId:e}):d.createElement(i,m)}):(console.log("替换失败",e),i)},module_replace:function(e,i){var d=window.require("react");return!d||!d.createElement?(console.log("没有，react"),i):typeof i=="function"&&!originalToString.call(i).includes(".jsx")?i:function(u){return d.createElement(i,u)}}}),window.fbmodules={};let n={};window.replaceIds=[],window.require=function(e){if(!fbmodules[e])if(window.moduleManager){let i=window.moduleManager.findModule(U[e]);fbmodules[e]=i?.[0]||{}}else fbmodules[e]={};return fbmodules[e]};let r=0;const a={0:o};let t;Object.defineProperty(webpackChunk_N_E,"push",{get:()=>{if(r>=0){const e=r;return function(){s(arguments[0][1]),clearTimeout(t),t=setTimeout(()=>{M()},1e3),a[e].apply(webpackChunk_N_E,arguments)}}return o},set:e=>{r++,a[r]=e}}),c(_),c(E),c(T),c(L)}N();const U={react:s=>s&&s.createElement&&s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,"react-dom":s=>s&&s.hydrateRoot&&s.render,jsx:s=>s.jsx}})();
