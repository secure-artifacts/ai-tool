(function(){"use strict";function F(e){if(e instanceof Error)return e.stack||e.message||String(e);if(e===null)return"null";if(e===void 0)return"undefined";if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint"||typeof e=="symbol")return String(e);try{return JSON.stringify(e)}catch{return Object.prototype.toString.call(e)}}async function C(e){let r;const o=e.headers.get("Content-Type")||"";try{if(o.includes("application/json"))r=await e.json();else if(o.includes("text/")){let t=await e.text();t=t.replace(/^for\s*\(\s*;;\s*\);/,"").trim();try{r=JSON.parse(t)}catch{r=t}}else if(o.includes("application/octet-stream")||o.includes("blob"))r=await e.blob();else if(o.includes("form-data"))r=await e.formData();else{let t=await e.text();try{r=JSON.parse(t)}catch{r=t}}}catch{}return r}window.currentProcess={row:null,prompt:"",folder:""},window.videoStorage=[],window.authorization="";function N(){const e=window.fetch;window.fetch=async(r,o)=>{const t=U(r),i=t.includes("/backend/nf/create"),l=t.includes("/backend/project_y/profile/drafts"),a={...window.currentProcess},u=await e(r,o);if(i&&a.row!=null||l){o?.headers?.Authorization&&(window.authorization=o.headers.Authorization);try{const n=u.clone(),s=await C(n);if(s){if(i){const c=s?.id;c&&a.row!=null&&(console.log("返回的task_id是：",c),window.emitter.emit("onSubmitSuccess",{...a,id:c}))}else if(l&&s.items){const c=window.videoStorage.map(f=>f.id);s.items.forEach(f=>{c.includes(f.id)||window.videoStorage.push({id:f.id,image:f.encodings?.thumbnail?.path||""})});const d=s.items.reduce((f,w)=>{const p=w.downloadable_url||w.url;return w.task_id&&p&&(f[w.task_id]=[{url:p,thumbnail:w.encodings?.thumbnail?.path||""}]),f},{});Object.keys(d).length&&(console.log("提取的视频链接是：",d),window.emitter.emit("onReceiveData",d))}}}catch(n){console.error(n)}}return u}}function U(e){return typeof e=="string"?e:e instanceof URL?e.href:e instanceof Request?e.url:String(e??"")}function I(e){return{all:e=e||new Map,on:function(r,o){var t=e.get(r);t?t.push(o):e.set(r,[o])},off:function(r,o){var t=e.get(r);t&&(o?t.splice(t.indexOf(o)>>>0,1):e.set(r,[]))},emit:function(r,o){var t=e.get(r);t&&t.slice().map(function(i){i(o)}),(t=e.get("*"))&&t.slice().map(function(i){i(r,o)})}}}function k(e,r){const o=t=>{r(t),window.emitter.off(e,o)};window.emitter.on(e,o)}const P=I();window.emitter=P;const y="jsx";L.id=y;function L(e,r){const o=Object.entries(e).find(t=>t[1]&&originalToString.call(t[1]).includes(".jsx="));if(o){console.log("找到------------------",y),window.replaceIds=window.replaceIds.filter(i=>i!==y);const t=e[o[0]];e[o[0]]=function(){t.apply(this,arguments);const i=arguments[0].exports.jsx;arguments[0].exports.jsx=function(l,a){return a.supportedMimeTypes&&a.onChange?window.uploadImage=async u=>{const n=new Promise(s=>{k("onUploadImageFinish",c=>{s(c)})});return a.onChange(u),n}:l==="textarea"&&a?.onChange&&(window.setPrompt=function(u){a.onChange({target:{value:u}})}),i(...arguments)},r[y]=arguments[0].exports}}}const m={Modules:[]};function D(){if(!window.modulefactory)return;console.log("刷新数据","modulefactory"),m.Modules=Object.keys(window.modulefactory.m).map(t=>{var i=null;try{i=window.modulefactory(t)}catch{}return i});const e=function(i){return window.modulefactory(i)},r=function(i){var l=[];return m.Modules.forEach(function(a){if(typeof a<"u")if(typeof i=="string"){if(typeof a.default=="object")for(const u in a.default)u==i&&l.push(a);for(const u in a)u==i&&l.push(a)}else if(typeof i=="function")i(a)&&l.push(a);else throw"沒有模塊"}),l},o=function(t){if(m.Modules==0)throw Error("沒有模塊");var i=[];if(typeof t=="string")m.Modules.forEach(function(l){l.toString().includes(t)&&i.push(l)});else if(typeof t=="function")m.Modules.forEach(function(l){t(l)&&i.push(l)});else throw Error("沒有模塊");return i};window.moduleManager={modules:m.Modules,findModule:r,findFunction:o,get:window.modulefactory?e:null}}const S="react";R.id=S;function R(e,r){const o=Object.entries(e).find(t=>t[1]&&originalToString.call(t[1]).includes(".createElement=")&&originalToString.call(t[1]).includes(".__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED="));if(o){console.log("找到------------------",S),window.replaceIds=window.replaceIds.filter(i=>i!==S);const t=e[o[0]];e[o[0]]=function(){window.modulefactory=arguments[2],t.apply(this,arguments),r[S]=arguments[0].exports}}}const x="react-dom";j.id=x;function j(e,r){const o=Object.entries(e).find(t=>t[1]&&originalToString.call(t[1]).includes(".render=")&&originalToString.call(t[1]).includes(".hydrateRoot="));if(o){window.replaceIds=window.replaceIds.filter(i=>i!==x);const t=e[o[0]];e[o[0]]=function(){t.apply(this,arguments),console.log("找到------------------",x),r[x]=arguments[0].exports}}}const b="submit";T.id=b;function T(e,r){const o=Object.entries(e).find(t=>t[1]&&originalToString.call(t[1]).includes("onSubmit:")&&originalToString.call(t[1]).includes(".isLoading"));if(o){window.replaceIds=window.replaceIds.filter(i=>i!==b),console.log("找到------------------",b);const t=e[o[0]];e[o[0]]=function(){t.apply(this,arguments);const i=arguments[0].exports,l=Object.keys(i);arguments[0].exports=l.reduce((a,u)=>(a[u]=window.heroReplace.module_replace(b,i[u]),a),{}),r[b]=arguments[0].exports}}}const _="uploadFile";M.id=_;function M(e,r){const o=Object.entries(e).find(t=>t[1]&&originalToString.call(t[1]).includes("supportedMimeTypes:")&&originalToString.call(t[1]).includes("maxImageSizeBytes:"));if(o){window.replaceIds=window.replaceIds.filter(i=>i!==_),console.log("找到------------------",_);const t=e[o[0]];e[o[0]]=function(){t.apply(this,arguments);const i=arguments[0].exports,l=Object.keys(i);arguments[0].exports=l.reduce((a,u)=>(a[u]=window.heroReplace.module_replace(_,i[u]),a),{}),r[_]=arguments[0].exports}}}if(window.webpackChunk_N_E)console.log("已经存在 webpackChunk_N_E");else{let e=function(n){replaceIds.length&&replaceIds.forEach(s=>{i[s]?i[s](n,fbmodules):window.replaceIds=window.replaceIds.filter(c=>c!==s)})},r=function(n){const s=n.id;i[s]=n,replaceIds.push(s)};console.log("不存在 webpackChunk_N_E");const o=Function.prototype.toString;window.originalToString=o,window.webpackChunk_N_E=[];let t=window.webpackChunk_N_E.push;window.eventListeners||(window.eventListeners={box:{},waitMount:{},componentStates:{},add:(n,s)=>{if(eventListeners.box[n]||(eventListeners.box[n]=[]),eventListeners.box[n].push(s),eventListeners.waitMount[n]!==void 0){let c=eventListeners.waitMount[n];delete eventListeners.waitMount[n],setTimeout(()=>{eventListeners.fire(n,c)},0)}return()=>{eventListeners.box[n]=eventListeners.box[n].filter(c=>c!==s)}},fire:(n,s)=>{eventListeners.box[n]?eventListeners.box[n].length>0?eventListeners.box[n].forEach(c=>{c(s)}):eventListeners.componentStates[n]=!!s:eventListeners.waitMount[n]=s}}),window.heroReplace||(window.heroReplace={node_replace:function(n,s,c,d){return d.createElement(function(){const w=!!eventListeners.componentStates[n];var[p,g]=d.useState(heroReplace[n+"_proxy"]?w:!1);return d.useEffect(()=>eventListeners.add(n,h=>{eventListeners.componentStates[n]=!!h,g(!!h)}),[g,n]),p&&heroReplace[n+"_proxy"]?d.createElement(heroReplace[n+"_proxy"],{sourceNode:s,mode:c,moduleId:n}):s},{})},memo_replace:function(n,s){var c=window.require("react");return c?.memo?c.memo(function(d,f,w,p){console.log(2,arguments);let g=Object.assign({},d,f,w,p);const h=!!eventListeners.componentStates[n];var[E,O]=c.useState(heroReplace[n+"_proxy"]?h:!1);return c.useEffect(()=>eventListeners.add(n,v=>{eventListeners.componentStates[n]=!!v,O(!!v)}),[O,n]),E&&heroReplace[n+"_proxy"]?c.createElement(heroReplace[n+"_proxy"],{sourcefunc:s,props:g,moduleId:n}):c.createElement(s,g)}):(console.log("替换失败",n),s)},module_replace:function(n,s){var c=window.require("react");return!c||!c.createElement?(console.log("没有，react"),s):typeof s=="function"&&!originalToString.call(s).includes(".jsx")?s:function(f){if(n==="submit"&&f.onSubmit)window.generateVideo=f.onSubmit;else if(n==="uploadFile"){const{onUploadComplete:w,onProjectYUploadComplete:p,onError:g,uploadMode:h}=f;p&&g&&(h==="project_y"?f.onProjectYUploadComplete=function(){return window.emitter.emit("onUploadImageFinish"),p(...arguments)}:f.onUploadComplete=function(){return window.emitter.emit("onUploadImageFinish"),w(...arguments)},f.onError=function(E){return window.emitter.emit("onUploadImageFinish",F(E)),g(...arguments)})}return c.createElement(s,f)}}}),window.fbmodules={};let i={};window.replaceIds=[],window.require=function(n){if(!fbmodules[n])if(window.moduleManager){let s=window.moduleManager.findModule(z[n]);fbmodules[n]=s?.[0]||{}}else fbmodules[n]={};return fbmodules[n]};let l=0;const a={0:t};let u;Object.defineProperty(webpackChunk_N_E,"push",{get:()=>{if(l>0){const n=l;return function(){e(arguments[0][1]),clearTimeout(u),u=setTimeout(()=>{D()},1e3),a[n].apply(webpackChunk_N_E,arguments)}}return t},set:n=>{l++,a[l]=n}}),r(R),r(j),r(L),r(T),r(M)}N();const z={react:e=>e&&e.createElement&&e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,"react-dom":e=>e&&e.hydrateRoot&&e.render,jsx:e=>e.jsx}})();
