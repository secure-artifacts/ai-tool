(function(){"use strict";const L="react";S.id=L;function S(i,l){const s=Object.entries(i).find(r=>r[1]&&originalToString.call(r[1]).includes(".createElement="));if(s){window.replaceIds=window.replaceIds.filter(a=>a!==L);const r=i[s[0]];i[s[0]]=function(){window.modulefactory=arguments[2],r.apply(this,arguments),console.log("找到------------------",L),l[L]=arguments[0].exports}}}function E(i){return new Promise(l=>setTimeout(l,i*1e3))}const y="jsx";A.id=y;function A(i,l){const s=Object.entries(i).find(r=>r[1]&&originalToString.call(r[1]).includes(".jsx="));if(s){window.replaceIds=window.replaceIds.filter(a=>a!==y);const r=i[s[0]];i[s[0]]=function(){window.modulefactory=arguments[2],r.apply(this,arguments),console.log("找到------------------",y),l[y]=arguments[0].exports;const a=arguments[0].exports.jsx;arguments[0].exports.jsx=function(d,n){if(n?.onChange){const e=n.referenceRenderProps?.visualIndex;e===0?window.uploadImage=async(t,o)=>(o==="image"?n.onChange(t):n.onChange(t[0]),""):e===1&&(window.uploadEndFrame=async t=>(n.onChange(t[0]),""))}else if(n?.items&&n.onMove&&n.onRemove)_=n.items;else if(n?.onRemove&&n.referenceId){const e=n.referenceRenderProps?.visualIndex;e===0?h=n.onRemove:e===1&&(b=n.onRemove)}else if(n?.onChange&&n.options){const{options:e}=n;Array.isArray(e)&&e.length&&e.find(t=>t.value==="image")&&e.find(t=>t.value==="video")&&(window.setCreateType=async t=>{n.onChange(t)})}return a.apply(this,arguments)};const u=arguments[0].exports.jsxs;arguments[0].exports.jsxs=function(d,n){return n?.onChange&&n.options&&(originalConsole.log("onClick",n),window.setCreateType=async e=>{n.onChange(e)}),u.apply(this,arguments)}}}}let _,h,b;window.clearUploadedImages=async i=>{if(i==="image"){if(h&&Array.isArray(_)&&_.length){for(const l of _.map(s=>s.id))h(l),await E(1);_=[]}}else h&&h(),b&&b(),await E(1)};const v="textInput";C.id=v;function C(i,l){const s=Object.entries(i).find(r=>r[1]&&originalToString.call(r[1]).includes("prompt-container"));if(s){window.replaceIds=window.replaceIds.filter(a=>a!==v),console.log("找到------------------",v);const r=i[s[0]];i[s[0]]=function(){window.modulefactory=arguments[2],r.apply(this,arguments);const a=arguments[0].exports,u=Object.keys(a)[0],d=a[u];arguments[0].exports={[u]:window.heroReplace.module_replace(v,d)},l[v]=arguments[0].exports}}}window.currentProcess={row:null,prompt:"",folder:"",filename:""};function D(){const i=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(l,s,...r){const a=j(s),u=a.includes("aigc_draft/generate"),d=a.includes("get_history_by_ids");if(u||d){const n={...window.currentProcess};(d||u&&n.row!=null)&&this.addEventListener("load",()=>{try{const e=JSON.parse(this.responseText);if(originalConsole.log("返回的body是：",e),u){const t=e?.data?.aigc_data?.submit_id;e?.errmsg==="success"&&t&&(originalConsole.log("返回的submit_id是：",t),window.emitter.emit("onSubmitSuccess",{id:t,...n}))}if(d&&typeof e.data=="object"){const t={};Object.entries(e.data).forEach(([o,w])=>{const c=w?.item_list;if(Array.isArray(c)&&c.length)if(c[0].video){const g=c.reduce((f,m)=>{const p=m?.video?.transcoded_video?.origin?.video_url,x=m.video?.cover_url;return p&&x&&f.push({url:p,thumbnail:x}),f},[]);g.length&&(t[o]=g)}else{const g=c.map(f=>f?.image?.large_images?.[0]?.image_url).filter(Boolean);g.length===4&&(t[o]=g.map(f=>({url:f,thumbnail:f})))}}),Object.keys(t).length&&(originalConsole.log("提取的视频链接是：",t),window.emitter.emit("onReceiveData",t))}}catch(e){originalConsole.error(this.responseText,"解析响应体出错：",e)}})}return i.apply(this,[l,s,...r])}}function j(i){if(typeof i=="string")return i;if(i instanceof URL)return i.toString();throw new TypeError("Unsupported fetch input type")}if(window.__LOADABLE_LOADED_CHUNKS__)console.log("已经存在 __LOADABLE_LOADED_CHUNKS__");else{let i=function(e){replaceIds.length&&replaceIds.forEach(t=>{a[t]?a[t](e,fbmodules):window.replaceIds=window.replaceIds.filter(o=>o!==t)})},l=function(e){const t=e.id;a[t]=e,replaceIds.push(t)};console.log("不存在 __LOADABLE_LOADED_CHUNKS__");const s=Function.prototype.toString;window.originalToString=s,window.originalConsole={...console},window.__LOADABLE_LOADED_CHUNKS__=[];let r=window.__LOADABLE_LOADED_CHUNKS__.push;window.eventListeners||(window.eventListeners={box:{},waitMount:{},componentStates:{},add:(e,t)=>{if(eventListeners.box[e]||(eventListeners.box[e]=[]),eventListeners.box[e].push(t),eventListeners.waitMount[e]!==void 0){let o=eventListeners.waitMount[e];delete eventListeners.waitMount[e],setTimeout(()=>{eventListeners.fire(e,o)},0)}return()=>{eventListeners.box[e]=eventListeners.box[e].filter(o=>o!==t)}},fire:(e,t)=>{eventListeners.box[e]?eventListeners.box[e].length>0?eventListeners.box[e].forEach(o=>{o(t)}):eventListeners.componentStates[e]=!!t:eventListeners.waitMount[e]=t}}),window.heroReplace||(window.heroReplace={node_replace:function(e,t,o,w){return w.createElement(function(){const g=!!eventListeners.componentStates[e];var[f,m]=w.useState(heroReplace[e+"_proxy"]?g:!1);return w.useEffect(()=>eventListeners.add(e,p=>{eventListeners.componentStates[e]=!!p,m(!!p)}),[m,e]),f&&heroReplace[e+"_proxy"]?w.createElement(heroReplace[e+"_proxy"],{sourceNode:t,mode:o,moduleId:e}):t},{})},memo_replace:function(e,t){var o=window.require("react");return o?.memo?o.memo(function(w,c,g,f){console.log(2,arguments);let m=Object.assign({},w,c,g,f);const p=!!eventListeners.componentStates[e];var[x,O]=o.useState(heroReplace[e+"_proxy"]?p:!1);return o.useEffect(()=>eventListeners.add(e,R=>{eventListeners.componentStates[e]=!!R,O(!!R)}),[O,e]),x&&heroReplace[e+"_proxy"]?o.createElement(heroReplace[e+"_proxy"],{sourcefunc:t,props:m,moduleId:e}):o.createElement(t,m)}):(console.log("替换失败",e),t)},module_replace:function(e,t){console.log("module_replace正在替换模块：",e);var o=window.require("react");return!o||!o.createElement?(console.log("没有，react"),t):function(c){return e==="textInput"&&(c.onChange&&(window.setPrompt=c.onChange),c.onSubmit&&(window.generate=window.generateVideo=c.onSubmit)),o.createElement(t,c)}}}),window.fbmodules={};let a={};window.replaceIds=[],window.require=function(e){if(fbmodules[e]||(fbmodules[e]={}),e=="react-dom"&&window.moduleManager&&!fbmodules[e].render){let t=window.moduleManager.findModule(o=>o&&o.hydrateRoot&&o.render);fbmodules[e]=t?.[0]||{}}return fbmodules[e]};let u=0;const d={0:r};let n;Object.defineProperty(__LOADABLE_LOADED_CHUNKS__,"push",{get:()=>{if(u>0){const e=u;return function(){i(arguments[0][1]),clearTimeout(n),n=setTimeout(()=>{},1e3),d[e].apply(__LOADABLE_LOADED_CHUNKS__,arguments)}}return r},set:e=>{u++,d[u]=e}}),l(S),l(A),l(C)}D()})();
